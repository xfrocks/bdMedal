<?xml version="1.0" encoding="utf-8"?>
<templates>
  <template type="admin" title="bdmedal_awarded" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:macro name="entity_edit" arg-entity="!">
    <xf:set var="$awarded" value="{$entity}"/>

    <xf:if is="$awarded.awarded_id > 0">
        <xf:formrow label="{{ phrase('bdmedal_medal_entity') }}">
            <a href="{{ link('medals/edit', $awarded.Medal) }}">{$awarded.Medal.name}</a>
        </xf:formrow>
        <xf:formrow label="{{ phrase('user_name') }}">
            <a href="{{ link('users/edit', $awarded.User) }}">{$awarded.username}</a>
        </xf:formrow>
    </xf:if>
</xf:macro>

<xf:macro name="entity_list_filters" arg-filters="!">
    <xf:if is="{$filters.medal}">
        <xf:set var="$tmpPageNavParams" value="{$filters.pageNavParams}"/>
        <xf:set var="$tmpPageNavParams.medal_id" value=""/>
        <xf:breadcrumb href="{{ link('awarded-medals', null, $tmpPageNavParams) }}">
            {$filters.medal.name}
        </xf:breadcrumb>
    </xf:if>
    <xf:if is="{$filters.user}">
        <xf:set var="$tmpPageNavParams" value="{$filters.pageNavParams}"/>
        <xf:set var="$tmpPageNavParams.user_id" value=""/>
        <xf:breadcrumb href="{{ link('awarded-medals', null, $tmpPageNavParams) }}">
            {$filters.user.username}
        </xf:breadcrumb>
    </xf:if>
</xf:macro>

<xf:macro name="entity_list_item_popup" arg-entity="!">
    <xf:set var="$awarded" value="{$entity}"/>

    <div class="menu" data-menu="menu" aria-hidden="true"
         data-menu-builder="dataList">
        <div class="menu-content">
            <a href="{{ link('awarded-medals', null, {'medal_id': $awarded.medal_id}) }}" class="menu-linkRow">
                {{ phrase('bdmedal_filter_by_medal') }}: {$awarded.Medal.name}
            </a>
            <a href="{{ link('awarded-medals', null, {'user_id': $awarded.user_id}) }}" class="menu-linkRow">
                {{ phrase('filter_by_user') }}: {$awarded.username}
            </a>
            <div class="js-menuBuilderTarget u-showMediumBlock"></div>
        </div>
    </div>
</xf:macro>]]></template>
  <template type="admin" title="bdmedal_awarded_add" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:title>{{ phrase('bdmedal_awarded_add') }}</xf:title>

<xf:form action="{{ link('awarded-medals/add') }}" ajax="true" class="block">
    <div class="block-container">

        <div class="block-body">
            <xf:selectrow label="{{ phrase('bdmedal_medal_entity') }}"
                          name="medal_id"
                          value="{$input.medal_id}">
                <xf:foreach loop="$medalTree" key="$categoryName" value="$medals">
                    <xf:optgroup label="{$categoryName}">
                        <xf:options source="$medals"/>
                    </xf:optgroup>
                </xf:foreach>
            </xf:selectrow>

            <xf:tokeninputrow explain="{{ phrase('separate_names_with_comma') }}"
                              href="{{ link_type('public', 'members/find') }}"
                              label="{{ phrase('user_names') }}"
                              name="usernames"
                              value="{$input.usernames}"/>

            <xf:textarearow hint="{{ phrase('you_may_use_html') }}"
                            label="{{ phrase('bdmedal_award_reason') }}"
                            name="award_reason"
                            value="{$input.award_reason}"/>

            <xf:checkboxrow label="">
                <xf:option name="avoid_duplicated"
                           value="1"
                           selected="{$xf.options.bdMedal_defaultAvoidDuplicated}">
                    {{ phrase('bdmedal_avoid_duplicated') }}
                </xf:option>
                <xf:explain>{{ phrase('bdmedal_avoid_duplicated_explain') }}</xf:explain>
            </xf:checkboxrow>
        </div>

        <xf:submitrow sticky="true" icon="save"/>
    </div>
</xf:form>]]></template>
  <template type="admin" title="bdmedal_entity_delete" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:comment>2018-04-17T19:02:43+00:00</xf:comment>
<xf:title>{{ phrase('confirm_action') }}</xf:title>

<xf:form action="{{ link($links.delete, $entity) }}" ajax="true" class="block">
    <div class="block-container">
        <div class="block-body">
            <xf:inforow rowtype="confirm">
                {{ phrase('please_confirm_that_you_want_to_delete_following:') }}
                <strong>
                    <xf:if is="{$links.edit}">
                        <a href="{{ link($links.edit, $entity) }}">{$entityLabel}</a>
                        <xf:else/>
                        {$entityLabel}
                    </xf:if>
                </strong>
            </xf:inforow>
        </div>
        <xf:submitrow rowtype="simple" icon="delete"/>
    </div>
</xf:form>]]></template>
  <template type="admin" title="bdmedal_entity_edit" version_id="2000010" version_string="2.0.0 Alpha"><![CDATA[<xf:comment>2018-04-24T04:14:04+00:00</xf:comment>
<xf:if is="$entity.isInsert()">
    <xf:title>{$phrases.add|raw}</xf:title>
    <xf:else/>
    <xf:title>{$phrases.edit|raw}: {$controller.getEntityLabel($entity)}</xf:title>
</xf:if>

<xf:pageaction if="$links.delete && $entity.isUpdate()">
    <xf:button href="{{ link({$links.delete}, $entity) }}" icon="delete" overlay="true"/>
</xf:pageaction>

<xf:form action="{{ link({$links.save}) }}" ajax="true" class="block">
    <div class="block-container">

        <div class="block-body">

            <xf:foreach loop="$columns" key="$columnName" value="$column">
                <xf:if is="{$column._structureData.macroTemplate}">
                    <xf:macro template="{$column._structureData.macroTemplate}" name="entity_edit_column"
                              arg-column="{$column}"
                              arg-columnName="{$columnName}"
							  arg-entity="{$entity}"/>

                    <xf:elseif is="!{$column.label}"/>
					<xf:hiddenval name="hidden_columns[]" value="{$columnName}"/>
                    <xf:hiddenval name="hidden_{$column.name}" value="{$column.value}"/>

                    <xf:elseif is="{$column.tag} === 'number-box'"/>
                    <xf:numberboxrow label="{$column.label}"
                                     min="{$column.tagOptions.min}"
                                     name="{$column.name}"
                                     value="{$column.value}"/>

                    <xf:elseif is="{$column.tag} === 'select'"/>
                    <xf:selectrow label="{$column.label}"
                                  name="{$column.name}"
                                  value="{$column.value}">
                        <xf:foreach loop="$column.tagOptions.choices" value="$choice">
                            <xf:option disabled="{$choice.disabled}"
                                       label="{$choice.label}"
                                       value="{$choice.value}"/>
                        </xf:foreach>
                    </xf:selectrow>

                    <xf:elseif is="{$column.tag} === 'text-area'"/>
					<xf:set var="$hint">
						<xf:if is="{$column._structureData.html}">
							{{ phrase('you_may_use_html') }}
						</xf:if>
					</xf:set>
                    <xf:textarearow hint="{{ trim($hint) }}"
									label="{$column.label}"
                                    name="{$column.name}"
                                    value="{{ $entity.get($columnName) }}"/>

                    <xf:elseif is="{$column.tag} === 'text-box'"/>
                    <xf:textboxrow label="{$column.label}"
								   maxlength="{$column._structureData.maxLength}"
                                   name="{$column.name}"
                                   value="{$column.value}"/>

                    <xf:elseif is="{$column.tag} === 'username'"/>
					<xf:hiddenval name="username_columns[]" value="{$columnName}"/>
					<xf:textboxrow ac="single"
								   autocomplete="off"
								   label="{$column.label}"
								   maxlength="{{ max_length($xf.visitor, 'username') }}"
								   name="username_{$column.name}"
								   placeholder="{{ phrase('name...') }}"
								   value="{$column.tagOptions.username}"/>
                </xf:if>
            </xf:foreach>

            <xf:if is="{$macroTemplateEntityEdit}">
                <xf:macro template="{$macroTemplateEntityEdit}" name="entity_edit"
                          arg-columns="{$columns}"
                          arg-entity="{$entity}"/>
            </xf:if>
        </div>

        <xf:hiddenval name="entity_id" value="{{ $entity.getEntityId() }}"/>
        <xf:submitrow sticky="true" icon="save"/>
    </div>
</xf:form>]]></template>
  <template type="admin" title="bdmedal_entity_list" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:comment>2018-04-18T09:03:02+00:00</xf:comment>
<xf:title>{$phrases.entities|raw}</xf:title>

<xf:if is="{$links.add}">
    <xf:pageaction>
        <xf:button href="{{ link($links.add) }}" icon="add">{$phrases.add|raw}</xf:button>
    </xf:pageaction>
</xf:if>

<xf:if is="$macroTemplateEntityListFilters">
	<xf:macro template="{$macroTemplateEntityListFilters}"
			  name="entity_list_filters"
			  arg-filters="{$filters}" />
</xf:if>

<xf:if is="$entities is not empty">
    <div class="block">
        <div class="block-outer">
            <xf:macro template="filter_macros" name="quick_filter" arg-key="{$phrases.entity}"
                      arg-class="block-outer-opposite"/>
        </div>
        <div class="block-container">
            <div class="block-body">
                <xf:datalist>
                    <xf:foreach loop="{$entities}" value="$entity">
                        <xf:set var="$editLink"
                                value="{{ $links.edit ? link($links.edit, $entity) : '' }}"/>
                        <xf:set var="$viewLink"
                                value="{{ (empty($editLink) && $links.view) ? link($links.view, $entity) : '' }}"/>
						<xf:set var="$popup">
							<xf:if is="$macroTemplateEntityListItemPopup">
								<xf:macro template="{$macroTemplateEntityListItemPopup}"
										  name="entity_list_item_popup"
										  arg-entity="{$entity}" />
							</xf:if>
						</xf:set>
                        <xf:datarow delete="{{ $links.delete ? link($links.delete, $entity) : '' }}"
									explain="{$controller.getEntityExplain($entity)}"
									hint="{$controller.getEntityHint($entity)}"
                                    href="{{ $editLink ?: $viewLink }}"
                                    label="{$controller.getEntityLabel($entity)}"
                                    overlay="{{ !!$viewLink }}">
							<xf:if is="trim($popup)">
								<xf:popup label="&#8226;&#8226;&#8226;">
									{$popup|raw}
								</xf:popup>
							</xf:if>
						</xf:datarow>
                    </xf:foreach>
                </xf:datalist>
                <div class="block-footer">
                    <span class="block-footer-counter">{{ display_totals($entities, $total) }}</span>
                </div>
            </div>
        </div>

        <xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
                    link="{$links.index}" params="{$filters.pageNavParams}"
                    wrapperclass="block-outer block-outer--after"/>
    </div>
    <xf:else/>
    <div class="blockMessage">{{ phrase('no_items_have_been_created_yet') }}</div>
</xf:if>]]></template>
  <template type="admin" title="bdmedal_medal_filter_by_user" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:title>{{ phrase('filter_by_user') }}: {$medal.name}</xf:title>
<xf:h1>{{ phrase('filter_by_user') }}</xf:h1>

<xf:breadcrumb href="{{ link('medals/edit', $medal) }}">{$medal.name}</xf:breadcrumb>

<xf:form action="{{ link('medals/filter-by-user', $medal) }}" ajax="true" class="block">
    <div class="block-container">

        <div class="block-body">
            <xf:textboxrow data-autosubmit="true"
                           data-single="true"
                           data-xf-init="auto-complete"
                           label="{{ phrase('user_name') }}"
                           name="username"
                           value="{$awarded.username}"/>
        </div>

        <xf:submitrow sticky="true" icon="filter"/>
    </div>
</xf:form>]]></template>
  <template type="admin" title="bdmedal_medal_image" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:title>{{ phrase('upload_image') }}: {$medal.name}</xf:title>
<xf:h1>{{ phrase('bdmedal_image') }}</xf:h1>

<xf:breadcrumb href="{{ link('medals/edit', $medal) }}">{$medal.name}</xf:breadcrumb>

<xf:form action="{{ link('medals/image', $medal) }}" ajax="true" class="block">
    <div class="block-container">

        <div class="block-body">
            <xf:set var="$imageUrlL" value="{$medal.getImageUrl('L')}"/>
            <xf:if is="$imageUrlL">
                <xf:uploadrow name="image_l" label="{{ phrase('bdmedal_image_l') }}">
                    <xf:html>
                        <br/>
                        <xf:macro name="img" arg-imageUrl="{$imageUrlL}" arg-medal="{$medal}"/>
                    </xf:html>
                </xf:uploadrow>
            </xf:if>

            <xf:set var="$imageUrlM" value="{$medal.getImageUrl('M')}"/>
            <xf:if is="$imageUrlM">
                <xf:uploadrow name="image_m" label="{{ phrase('bdmedal_image_m') }}">
                    <xf:html>
                        <br/>
                        <xf:macro name="img" arg-imageUrl="{$imageUrlM}" arg-medal="{$medal}"/>
                    </xf:html>
                </xf:uploadrow>
            </xf:if>

            <xf:set var="$imageUrlS" value="{$medal.getImageUrl('S')}"/>
            <xf:if is="$imageUrlS">
                <xf:uploadrow name="image_s" label="{{ phrase('bdmedal_image_s') }}">
                    <xf:html>
                        <br/>
                        <xf:macro name="img" arg-imageUrl="{$imageUrlS}" arg-medal="{$medal}"/>
                    </xf:html>
                </xf:uploadrow>
            </xf:if>
        </div>

        <xf:submitrow sticky="true" icon="save"/>
    </div>
</xf:form>

<xf:macro name="entity_edit" arg-entity="!">
    <xf:set var="$medal" value="{$entity}"/>
    <xf:set var="$imageUrl" value="{$medal.getImageUrl('L')}"/>
    <xf:if is="!$imageUrl">
        <xf:uploadrow name="image" label="{{ phrase('upload_image') }}"/>

        <xf:else/>
        <xf:formrow label="{{ phrase('bdmedal_image') }}">
            <xf:macro name="img" arg-imageUrl="{$imageUrl}" arg-medal="{$medal}" arg-renderLink="1"/>

            <xf:checkbox label="">
                <xf:option name="delete_image" value="1">{{ phrase('delete') }}</xf:option>
            </xf:checkbox>
        </xf:formrow>
    </xf:if>
</xf:macro>

<xf:macro name="img" arg-imageUrl="!" arg-medal="!" arg-renderLink="">
    <xf:set var="$img"><img src="{$imageUrl}" style="max-height: 100px"/></xf:set>
    <xf:if is="!$renderLink || $medal.is_svg">
        {$img|raw}
        <xf:else/>
        <a href="{{ link('medals/image', $medal) }}" data-xf-click="overlay">{$img|raw}</a>
    </xf:if>
</xf:macro>]]></template>
  <template type="admin" title="bdmedal_medal_list" version_id="2000030" version_string="2.0.0 Beta"><![CDATA[<xf:title>{{ phrase('bdmedal_medal_entities') }}</xf:title>

<xf:pageaction>
    <xf:button href="{{ link('medals/add') }}" data-xf-click="overlay">{{ phrase('bdmedal_medal_add') }}</xf:button>
    <xf:button href="{{ link('medal-categories/add') }}" data-xf-click="overlay">
        {{ phrase('bdmedal_category_add') }}
    </xf:button>

    <xf:if is="$xf.visitor.hasAdminPermission('rebuildCache')">
        <xf:button href="{{ link('medals/rebuild') }}">{{ phrase('rebuild_caches') }}</xf:button>
    </xf:if>
</xf:pageaction>

<xf:if is="count($categories) > 0">
    <div class="block">
        <div class="block-outer">
            <xf:macro template="filter_macros" name="quick_filter" arg-key="medals"
                      arg-class="block-outer-opposite"/>
        </div>
        <div class="block-container">
            <div class="block-body">
                <xf:datalist>
                    <xf:foreach loop="$categories" value="$category">
                        <tbody class="dataList-rowGroup">
                        <xf:datarow rowtype="subsection">
                            <xf:cell href="{{ link('medal-categories/edit', $category) }}"
                                     colspan="3" overlay="true">
                                {{ $category.name }}
                            </xf:cell>
                            <xf:delete href="{{ link('medal-categories/delete', $category) }}"/>
                        </xf:datarow>

                        <xf:if contentcheck="true">
                            <xf:contentcheck>
                                <xf:foreach loop="$medals" value="$medal">
                                    <xf:if is="$medal.category_id === $category.category_id">
                                        <xf:datarow>
                                            <xf:cell href="{{ link('medals/edit', $medal) }}"
                                                     class="dataList-cell--min dataList-cell--image">
                                                <xf:macro template="public:bdmedal_macros" name="image"
                                                          arg-medal="{$medal}"/>
                                            </xf:cell>
                                            <xf:cell href="{{ link('medals/edit', $medal) }}">
                                                {$medal.name}
                                                <span class="dataList-hint">
                                                    {{ phrase('display_order') }}: {$medal.display_order}
                                                </span>
                                                <xf:if is="$medal.description">
                                                    <div class="dataList-subRow">{$medal.description|strip_tags}</div>
                                                </xf:if>
                                            </xf:cell>

                                            <xf:action
                                                    href="{{ link('awarded-medals', null, {'medal_id': $medal.medal_id}) }}"
                                                    class="dataList-cell--responsiveMenuItem">{{
                                                phrase('bdmedal_awarded_entities') }}
                                            </xf:action>

                                            <xf:popup label="&#8226;&#8226;&#8226;">
                                                <div class="menu" data-menu="menu" aria-hidden="true"
                                                     data-menu-builder="dataList">
                                                    <div class="menu-content">
                                                        <h3 class="menu-header">{$medal.name}</h3>
                                                        <a href="{{ link('awarded-medals/add', null, {'medal_id': $medal.medal_id}) }}"
                                                           class="menu-linkRow" data-xf-click="overlay">
                                                            {{ phrase('bdmedal_awarded_add') }}
                                                        </a>
                                                        <a href="{{ link('medals/filter-by-user', $medal) }}"
                                                           class="menu-linkRow" data-xf-click="overlay">
                                                            {{ phrase('filter_by_user') }}
                                                        </a>
                                                        <a href="{{ link('medals/delete', $medal) }}"
                                                           class="menu-linkRow" data-xf-click="overlay">
                                                            {{ phrase('delete') }}
                                                        </a>
                                                        <div class="js-menuBuilderTarget u-showMediumBlock"></div>
                                                    </div>
                                                </div>
                                            </xf:popup>
                                        </xf:datarow>
                                    </xf:if>
                                </xf:foreach>
                            </xf:contentcheck>

                            <xf:else/>
                            <xf:datarow rowclass="dataList-row--noHover dataList-row--note">
                                <xf:cell colspan="4" class="dataList-cell--noSearch">
                                    {{ phrase('bdmedal_no_medals_have_been_created_yet') }}
                                </xf:cell>
                            </xf:datarow>
                        </xf:if>
                        </tbody>
                    </xf:foreach>
                </xf:datalist>
            </div>
        </div>
    </div>
    <xf:else/>
    <div class="blockMessage">{{ phrase('bdmedal_no_medals_have_been_created_yet') }}</div>
</xf:if>]]></template>
  <template type="admin" title="bdmedal_rebuild" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:title>{{ phrase('rebuild_caches') }}</xf:title>

<xf:macro template="tools_rebuild" name="rebuild_job"
	arg-header="{{ phrase('rebuild_user_caches') }}"
	arg-job="Xfrocks\Medal:User" />]]></template>
  <template type="admin" title="widget_def_options_bdmedal_user_medals" version_id="2000010" version_string="2.0.0 Alpha"><![CDATA[]]></template>
  <template type="public" title="_help_page_medals" version_id="2000070" version_string="2.0.0"><![CDATA[<xf:if is="$medals is not empty">
    <div class="block">
        <div class="block-container">
            <ol class="block-body">
                <xf:foreach loop="$categories" value="$category">
                    <xf:if contentcheck="true">
                        <li class="block-row">
                            <h2 class="block-textHeader">{$category.name}</h2>
                            <xf:if is="$category.description">
                                <div class="description">{$category.description|raw}</div>
                            </xf:if>
                        </li>

                        <xf:contentcheck>
                            <xf:foreach loop="$medals" value="$medal">
                                <xf:if is="$medal.category_id === $category.category_id">
                                    <li class="block-row block-row--separated">
                                        <div class="contentRow">
                                            <span class="contentRow-figure">
                                                <xf:macro template="bdmedal_macros" name="image"
                                                          arg-medal="{$medal}"/>
                                            </span>
                                            <div class="contentRow-main">
                                                <h3 class="contentRow-header">{$medal.name}</h3>
                                                <div class="contentRow-minor">{$medal.description|raw}</div>

                                                <div class="contentRow-extra">
                                                    <a href="{{ link('medals/users', null, {'medal_id': $medal.medal_id}) }}"
                                                       data-xf-click="overlay">
                                                        {{ phrase('bdmedal_awarded_count') }}:
                                                        {$medal.user_count|number_short}
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </xf:if>
                            </xf:foreach>
                        </xf:contentcheck>
                    </xf:if>
                </xf:foreach>
            </ol>
        </div>
    </div>

    <xf:else/>
    <div class="blockMessage">{{ phrase('bdmedal_no_medals_have_been_created_yet') }}</div>
</xf:if>
]]></template>
  <template type="public" title="alert_medal_insert" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:if is="!$user">
    {{ phrase('bdmedal_you_have_been_awarded_medal_x', {
        'medal': $content.Medal.name
    }) }}

    <xf:else/>
    {{ phrase('bdmedal_x_awarded_medal_y', {
        'name': username_link($user, false, {'defaultname': $alert.username}),
        'medal': $content.Medal.name
    }) }}
</xf:if>]]></template>
  <template type="public" title="bdmedal.less" version_id="2000030" version_string="2.0.0 Beta"><![CDATA[.bdMedal_medalImage {
  background: center center no-repeat;
  background-size: contain;
  display: inline-block;

  .bdMedal_userMedals &.size-m {
    .xf-bdMedal_medalImageM();
  }
  .bdMedal_userMedals &.size-s {
    .xf-bdMedal_medalImageS();
  }
}

.bdMedal_medalListImage {
  .xf-bdMedal_medalListImage();
}

.bdMedal_messageUserMedals {
  &.position-message_user_info_text_bottom {
    margin-top: @xf-paddingSmall;
  }

  .bdMedal_medalImage {
    .xf-bdMedal_messageImage();
  }
}

.bdMedal_widgetUserMedals {
  .bdMedal_medalImage {
    .xf-bdMedal_widgetImage();
  }
}

ul.bdMedal_userMedals {
  list-style: none;
  margin: 0;
  padding: 0;

  li {
    display: inline-block;
  }

  a, img {
    display: inline-block;
    height: 100%;
    opacity: 0;
    width: 100%;
  }
}
]]></template>
  <template type="public" title="bdmedal_macros" version_id="2000030" version_string="2.0.0 Beta"><![CDATA[<xf:macro name="image" arg-medal="!">
    <xf:css src="bdmedal.less"/>
    <xf:set var="$medalImageUrl" value="{$medal.getImageUrl('L')}"/>
    <xf:if is="$medalImageUrl">
        <div class="bdMedal_medalImage bdMedal_medalListImage"
             style="background-image: url('{$medalImageUrl}');">
            &nbsp;
        </div>
    </xf:if>
</xf:macro>

<xf:macro name="user_medals" arg-imageSize="!" arg-max="0" arg-showDate="{{ false }}" arg-user="!">
    <xf:if is="$imageSize && $user.medal_count > 0">
        <xf:css src="bdmedal.less"/>
        <ul class="bdMedal_userMedals">
            <xf:set var="$renderedCount" value="0"/>
            <xf:foreach loop="$user.medal_awardeds" i="$i" value="$awarded">
                <xf:if is="!$max || $renderedCount < $max">
                    <xf:set var="$medal" value="{$awarded.Medal}"/>
                    <xf:set var="$medalImageUrl" value="{$medal.getImageUrl($imageSize)}"/>
                    <xf:if is="$medalImageUrl">
                        <xf:set var="$medalTooltip">
                            <xf:if is="$showDate">
                                {{ phrase('bdmedal_medal_tooltip_with_date',
                                {'medal': $medal.name, 'date': date($awarded.award_date)}) }}
                                <xf:else/>
                                {{ phrase('bdmedal_medal_tooltip_without_date', {'medal': $medal.name}) }}
                            </xf:if>
                        </xf:set>

                        <li class="medal-{$medal.medal_id} i{$renderedCount}{{ $medal.is_svg ? ' is-svg' : ''}}">
                            <div class="bdMedal_medalImage size-{$imageSize|to_lower}" style="background-image: url('{$medalImageUrl}');">
                                <a href="{{ link('members/medals', $user) }}"
                                   data-xf-click="overlay"
                                   data-xf-init="tooltip" data-html="true"
                                   title="{{ trim($medalTooltip)|raw|for_attr }}">
                                    <img src="{$medalImageUrl}" alt="{$medal.name}"/>
                                </a>
                            </div>
                        </li>


                        <xf:set var="$renderedCount" value="{{ $renderedCount + 1 }}"/>
                    </xf:if>
                </xf:if>
            </xf:foreach>
        </ul>
    </xf:if>
</xf:macro>
]]></template>
  <template type="public" title="bdmedal_medal_award" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:title>{{ phrase('bdmedal_awarded_add') }}</xf:title>

<xf:breadcrumb href="{{ link('help/medals') }}">{{ phrase('help_page_title.medals') }}</xf:breadcrumb>

<xf:form action="{{ link('medals/award') }}" class="block" ajax="true">
    <div class="block-container">
        <div class="block-body">
            <xf:selectrow label="{{ phrase('bdmedal_medal_entity') }}"
                          name="medal_id"
                          value="{$input.medal_id}">
                <xf:foreach loop="$medalTree" key="$categoryName" value="$medals">
                    <xf:optgroup label="{$categoryName}">
                        <xf:options source="$medals"/>
                    </xf:optgroup>
                </xf:foreach>
            </xf:selectrow>

            <xf:textboxrow data-single="true"
                           data-xf-init="auto-complete"
                           label="{{ phrase('user_name') }}"
                           name="username"
                           value="{$input.username}"/>

            <xf:textarearow label="{{ phrase('bdmedal_award_reason') }}"
                            name="award_reason"
                            value="{$input.award_reason}"/>
        </div>

        <xf:submitrow icon="save"/>
    </div>
</xf:form>]]></template>
  <template type="public" title="bdmedal_medal_users" version_id="2000030" version_string="2.0.0 Beta"><![CDATA[<xf:title>{$medal.name}</xf:title>

<xf:breadcrumb href="{{ link('help/medals') }}">{{ phrase('help_page_title.medals') }}</xf:breadcrumb>

<xf:if is="$awardeds is not empty">
    <div class="block">
        <div class="block-container">
            <div class="block-body">
                <xf:datalist class="dataList--contained" data-xf-init="responsive-data-list">
                    <xf:foreach loop="$awardeds" value="$awarded">
                        <xf:datarow rowclass="dataList-row--noHover">
                            <xf:cell class="dataList-cell--min dataList-cell--image">
                                <xf:avatar user="{$awarded.User}" size="s"/>
                            </xf:cell>
                            <xf:cell>
                                <xf:username user="{$awarded.User}" notooltip="true" rich="true"/>
                                <xf:if is="$awarded.award_reason">
                                    <span class="dataList-hint">{$awarded.award_reason|raw}</span>
                                </xf:if>
                            </xf:cell>
                            <xf:cell class="dataList-cell--min dataList-cell--alt">
                                <span class="dataList-hint">
                                    <xf:date time="{$awarded.award_date}"/>
                                </span>
                            </xf:cell>
                        </xf:datarow>
                    </xf:foreach>
                </xf:datalist>
                <div class="block-footer">
                    <span class="block-footer-counter">{{ display_totals($awardeds, $total) }}</span>
                </div>
            </div>
        </div>

        <xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
                    link="medals/users" params="{$pageNavParams}"
                    wrapperclass="block-outer block-outer--after"/>
    </div>

    <xf:else/>
    <div class="blockMessage">
        {{ phrase('bdmedal_no_users_have_been_awarded_medal_x_yet', {'medal': $medal.name}) }}
    </div>
</xf:if>]]></template>
  <template type="public" title="bdmedal_member_view_macros" version_id="2000370" version_string="2.0.3"><![CDATA[<xf:macro name="moderator_menu_actions" arg-user="!">
    <xf:if is="$xf.visitor.canAwardMedal({$user})">
        <a href="{{ link('medals/award', null, {'username': $user.username}) }}" class="menu-linkRow"
           data-xf-click="overlay">
            {{ phrase('bdmedal_awarded_add') }}
        </a>
    </xf:if>
</xf:macro>

<xf:macro name="stat_pair" arg-user="!">
    <xf:if is="property('bdMedal_showStatPair')">
        <dl class="pairs pairs--rows pairs--rows--centered fauxBlockLink">
            <dt>{{ phrase('bdmedal_medal_entities') }}</dt>
            <dd>
                <a href="{{ link('members/medals', $user) }}" data-xf-click="overlay"
                   class="fauxBlockLink-linkRow u-concealed">
                    {$user.medal_count|number}
                </a>
            </dd>
        </dl>
    </xf:if>
</xf:macro>

<xf:macro name="tabs" arg-user="!">
    <xf:if is="property('bdMedal_showTab') && $user.medal_count > 0">
        <a class="tabs-tab"
           href="{{ link('members/medals', $user) }}"
           id="bdMedal"
           rel="nofollow"
           role="tab">
            {{ phrase('bdmedal_awarded_medals') }}
        </a>
    </xf:if>
</xf:macro>

<xf:macro name="tab_panes" arg-user="!">
    <xf:if is="property('bdMedal_showTab') && $user.medal_count > 0">
        <li data-href="{{ link('members/medals', $user) }}" role="tabpanel" aria-labelledby="bdMedal">
            <div class="blockMessage">{{ phrase('loading...') }}</div>
        </li>
    </xf:if>
</xf:macro>]]></template>
  <template type="public" title="bdmedal_message_macros" version_id="2000010" version_string="2.0.0 Alpha"><![CDATA[<xf:macro name="user_medals" arg-position="manual" arg-user="!">
    <xf:if contentcheck="true">
        <xf:css src="bdmedal.less"/>
        <div class="bdMedal_messageUserMedals position-{$position|for_attr}">
            <xf:contentcheck>
                <xf:macro template="bdmedal_macros" name="user_medals"
                          arg-imageSize="{{ property('bdMedal_messageImageSize') }}"
                          arg-max="{{ property('bdMedal_messageMax') }}"
                          arg-showDate="{{ property('bdMedal_messageShowDate') }}"
                          arg-user="{$user}"/>
            </xf:contentcheck>
        </div>
    </xf:if>
</xf:macro>
]]></template>
  <template type="public" title="bdmedal_user_medals" version_id="2000070" version_string="2.0.0"><![CDATA[<xf:title>{{ phrase('bdmedal_medals_awarded_to_x', {'name': {$user.username}}) }}</xf:title>
<xf:h1>{{ phrase('bdmedal_awarded_medals') }}</xf:h1>

<xf:breadcrumb href="{{ link('help/medals') }}">{{ phrase('help_page_title.medals') }}</xf:breadcrumb>
<xf:breadcrumb href="{{ link('members', $user) }}">{$user.username}</xf:breadcrumb>

<xf:if is="$awardeds is not empty">
    <div class="block">
        <div class="block-container">
            <ol class="block-body">
                <xf:foreach loop="$awardeds" value="$awarded">
                    <xf:set var="$medal" value="{$awarded.Medal}"/>
                    <li class="block-row block-row--separated">
                        <div class="contentRow">
                            <span class="contentRow-figure">
                                <xf:macro template="bdmedal_macros" name="image"
                                          arg-medal="{$medal}"/>
                            </span>
                            <div class="contentRow-main">
                                <h3 class="contentRow-header">{$medal.name}</h3>
                                <div class="contentRow-minor">
                                    <xf:date time="{$awarded.award_date}"/>.
                                    {{ ($awarded.award_reason ? $awarded.award_reason : $medal.description)|raw }}
                                </div>
                            </div>
                        </div>
                    </li>
                </xf:foreach>
            </ol>

            <xf:if contentcheck="true">
                <div class="block-footer block-footer--split">
                <span class="block-footer-controls">
                    <xf:contentcheck>
                        <xf:if is="{$xf.visitor.canAwardMedal($user)}">
                            <xf:button href="{{ link('medals/award', null, {'username': $user.username}) }}"
                                       data-xf-click="overlay">
                                {{ phrase('bdmedal_awarded_add') }}
                            </xf:button>
                        </xf:if>
                        <xf:if is="{$xf.visitor.canSortMedals($user)}">
                            <xf:button href="{{ link('members/sort-medals', $user) }}" data-xf-click="overlay">
                                {{ phrase('sort') }}
                            </xf:button>
                        </xf:if>
                    </xf:contentcheck>
				</span>
                </div>
            </xf:if>
        </div>
    </div>

    <xf:else/>
    <div class="blockMessage">
        {{ phrase('bdmedal_no_medals_have_been_awarded_yet') }}
    </div>
</xf:if>]]></template>
  <template type="public" title="bdmedal_user_sort_medals" version_id="2000000" version_string="2.0.0"><![CDATA[<xf:title>{{ phrase('bdmedal_sort_medals') }}</xf:title>

<xf:macro template="public:nestable_macros" name="setup"/>

<xf:form action="{{ link('members/sort-medals', $user) }}" class="block" ajax="true">
    <div class="block-container">
        <div class="block-body">
            <div class="nestable-container" data-xf-init="nestable" data-value-target=".js-sortData">
                <ol class="nestable-list">
                    <xf:foreach loop="{$awardeds}" value="$awarded" i="$i">
                        <li class="nestable-item" data-id="{$awarded.awarded_id}">
                            <div class="nestable-handle nestable-handle--full" aria-label="{{ phrase('drag_handle') }}">
                                <i class="fa fa-bars" aria-hidden="true"></i>
                            </div>
                            <div class="nestable-content">
                                {$awarded.Medal.name}
                                ({{ date({$awarded.award_date}) }})
                            </div>
                        </li>
                    </xf:foreach>
                </ol>
                <xf:hiddenval name="sort_data" value="" class="js-sortData"/>
            </div>
        </div>

        <xf:submitrow icon="save" rowtype="simple"/>
    </div>
</xf:form>]]></template>
  <template type="public" title="bdmedal_widget_user_medals" version_id="2000030" version_string="2.0.0 Beta"><![CDATA[<xf:if contentcheck="true">
    <xf:css src="bdmedal.less"/>
    <div class="block" {{ widget_data($widget) }}>
        <div class="block-container">
            <h3 class="block-minorHeader">
                <a href="{{ link('members/medals', $user) }}">
                    {$title}
                </a>
            </h3>
            <div class="block-body">
                <div class="block-row bdMedal_widgetUserMedals">
                    <xf:contentcheck>
                        <xf:macro template="bdmedal_macros" name="user_medals"
                                  arg-imageSize="{{ property('bdMedal_widgetImageSize') }}"
                                  arg-max="{{ property('bdMedal_widgetMax') }}"
                                  arg-showDate="{{ property('bdMedal_widgetShowDate') }}"
                                  arg-user="{$user}"/>
                    </xf:contentcheck>
                </div>
            </div>
        </div>
    </div>
</xf:if>]]></template>
  <template type="public" title="news_feed_item_medal_insert" version_id="2000000" version_string="2.0.0"><![CDATA[<div class="contentRow-title">
    <xf:if is="$user.user_id === $xf.visitor.user_id">
        {{ phrase('bdmedal_you_have_been_awarded_medal_x', {
            'medal': $content.Medal.name
        }) }}
        <xf:else/>
        {{ phrase('bdmedal_x_have_been_awarded_medal_y', {
            'name': username_link($user, false, {'defaultname': $newsFeed.username}),
            'medal': $content.Medal.name
        }) }}
    </xf:if>
</div>

<xf:if contentcheck="true">
    <div class="contentRow-snippet">
        <xf:contentcheck>{$content.award_reason|raw}</xf:contentcheck>
    </div>
</xf:if>

<xf:set var="$imageUrl" value="{$content.Medal.getImageUrl('L')}"/>
<xf:if is="$imageUrl">
    <ul class="listPlain listInline listInline--block">
        <li>
            <a href="{$link}"><img src="{$imageUrl}" alt="{$content.Medal.name}"/></a>
        </li>
    </ul>
</xf:if>

<div class="contentRow-minor">
    <xf:date time="{$newsFeed.event_date}"/>
</div>]]></template>
</templates>
